import logging
from telegram import Update, ReplyKeyboardMarkup, KeyboardButton
from telegram.ext import Application, CommandHandler, MessageHandler, filters, ContextTypes
from datetime import datetime
import random

# –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è
logging.basicConfig(
    format='%(asctime)s - %(name)s - %(levelname)s - %(message)s',
    level=logging.INFO
)
logger = logging.getLogger(__name__)  # –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ: –±—ã–ª–æ name, –Ω—É–∂–Ω–æ __name__

# –¢–æ–∫–µ–Ω –±–æ—Ç–∞ (–ó–ê–ú–ï–ù–ò–¢–ï –≠–¢–û–¢ –¢–û–ö–ï–ù, —Ç–∞–∫ –∫–∞–∫ –æ–Ω –±—ã–ª —Å–∫–æ–º–ø—Ä–æ–º–µ—Ç–∏—Ä–æ–≤–∞–Ω)
BOT_TOKEN = "8272835383:AAHs1Ke2eZzRCh9sOg-8BHVA1q0WjdLkXU0"

# –°–æ–∑–¥–∞–Ω–∏–µ –æ—Å–Ω–æ–≤–Ω–æ–π –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã
def create_main_keyboard():
    keyboard = [
        [KeyboardButton("üìä –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è"), KeyboardButton("üÜò –ü–æ–º–æ—â—å")],
        [KeyboardButton("üå§ –ü–æ–≥–æ–¥–∞"), KeyboardButton("üí∞ –ö—É—Ä—Å –≤–∞–ª—é—Ç")],
        [KeyboardButton("üé≤ –°–ª—É—á–∞–π–Ω–æ–µ —á–∏—Å–ª–æ"), KeyboardButton("üìÖ –î–∞—Ç–∞ –∏ –≤—Ä–µ–º—è")],
        [KeyboardButton("üë§ –û —Å–æ–∑–¥–∞—Ç–µ–ª–µ")]
    ]
    return ReplyKeyboardMarkup(keyboard, resize_keyboard=True, input_field_placeholder="–í—ã–±–µ—Ä–∏—Ç–µ –¥–µ–π—Å—Ç–≤–∏–µ...")

# –°–æ–∑–¥–∞–Ω–∏–µ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–π –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã
def create_secondary_keyboard():
    keyboard = [
        [KeyboardButton("üîô –ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é"), KeyboardButton("üéØ –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ")],
        [KeyboardButton("üìû –ö–æ–Ω—Ç–∞–∫—Ç—ã"), KeyboardButton("‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏")]
    ]
    return ReplyKeyboardMarkup(keyboard, resize_keyboard=True)

# –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–æ–º–∞–Ω–¥—ã /start
async def start(update: Update, context: ContextTypes.DEFAULT_TYPE):
    user = update.message.from_user
    welcome_text = f"üëã –ü—Ä–∏–≤–µ—Ç, {user.first_name}!\n\n–Ø –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–æ–Ω–Ω—ã–π –±–æ—Ç –¥–ª—è –ª–∞–±–æ—Ä–∞—Ç–æ—Ä–Ω–æ–π —Ä–∞–±–æ—Ç—ã ‚Ññ5.\n–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∫–Ω–æ–ø–∫–∏ –Ω–∏–∂–µ –¥–ª—è –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è:"
    
    await update.message.reply_text(
        welcome_text,
        reply_markup=create_main_keyboard()
    )

# –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–æ–º–∞–Ω–¥—ã /help
async def help_command(update: Update, context: ContextTypes.DEFAULT_TYPE):
    help_text = """
ü§ñ *–î–æ—Å—Ç—É–ø–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã:*
/start - –Ω–∞—á–∞—Ç—å —Ä–∞–±–æ—Ç—É —Å –±–æ—Ç–æ–º
/help - –ø–æ–ª—É—á–∏—Ç—å —Å–ø—Ä–∞–≤–∫—É

üéØ *–î–æ—Å—Ç—É–ø–Ω—ã–µ –¥–µ–π—Å—Ç–≤–∏—è —á–µ—Ä–µ–∑ –∫–Ω–æ–ø–∫–∏:*
üìä –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è - –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –±–æ—Ç–µ
üÜò –ü–æ–º–æ—â—å - –ø–æ–∫–∞–∑–∞—Ç—å —ç—Ç—É —Å–ø—Ä–∞–≤–∫—É
üå§ –ü–æ–≥–æ–¥–∞ - –ø–æ–ª—É—á–∏—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –ø–æ–≥–æ–¥–µ
üí∞ –ö—É—Ä—Å –≤–∞–ª—é—Ç - —É–∑–Ω–∞—Ç—å —Ç–µ–∫—É—â–∏–π –∫—É—Ä—Å
üé≤ –°–ª—É—á–∞–π–Ω–æ–µ —á–∏—Å–ª–æ - —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å —Å–ª—É—á–∞–π–Ω–æ–µ —á–∏—Å–ª–æ
üìÖ –î–∞—Ç–∞ –∏ –≤—Ä–µ–º—è - –ø–æ–∫–∞–∑–∞—Ç—å —Ç–µ–∫—É—â–µ–µ –≤—Ä–µ–º—è
üë§ –û —Å–æ–∑–¥–∞—Ç–µ–ª–µ - –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–µ
    """
    await update.message.reply_text(help_text, parse_mode='Markdown')

# –û–±—Ä–∞–±–æ—Ç—á–∏–∫ —Ç–µ–∫—Å—Ç–æ–≤—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π (–∫–Ω–æ–ø–æ–∫)
async def handle_message(update: Update, context: ContextTypes.DEFAULT_TYPE):
    text = update.message.text
    
    responses = {
        "üìä –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è": 
            "ü§ñ *–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –±–æ—Ç–µ*\n\n"
            "–≠—Ç–æ –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–æ–Ω–Ω—ã–π –±–æ—Ç —Å–æ–∑–¥–∞–Ω–Ω—ã–π –¥–ª—è:\n"
            "‚Ä¢ –õ–∞–±–æ—Ä–∞—Ç–æ—Ä–Ω–æ–π —Ä–∞–±–æ—Ç—ã ‚Ññ5\n"
            "‚Ä¢ –î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–∏ —Ä–∞–±–æ—Ç—ã —Å Telegram Bot API\n"
            "‚Ä¢ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã—Ö –∫–Ω–æ–ø–æ–∫\n\n"
            "‚ö°Ô∏è *–¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏:* Python, python-telegram-bot",
        
        "üÜò –ü–æ–º–æ—â—å": None,  # –ë—É–¥–µ—Ç –æ–±—Ä–∞–±–æ—Ç–∞–Ω –æ—Ç–¥–µ–ª—å–Ω–æ
        
        "üå§ –ü–æ–≥–æ–¥–∞": 
            "üå§ *–ü—Ä–æ–≥–Ω–æ–∑ –ø–æ–≥–æ–¥—ã*\n\n"
            "üìç –ú–æ—Å–∫–≤–∞\n"
            "‚õÖÔ∏è –°–µ–≥–æ–¥–Ω—è: +18¬∞C, —Å–æ–ª–Ω–µ—á–Ω–æ\n"
            "üåô –í–µ—á–µ—Ä–æ–º: +12¬∞C, —è—Å–Ω–æ\n"
            "üí® –í–µ—Ç–µ—Ä: 3 –º/—Å, –∑–∞–ø–∞–¥–Ω—ã–π\n"
            "üíß –í–ª–∞–∂–Ω–æ—Å—Ç—å: 65%",
        
        "üí∞ –ö—É—Ä—Å –≤–∞–ª—é—Ç": 
            "üí± *–ö—É—Ä—Å—ã –≤–∞–ª—é—Ç –Ω–∞ —Å–µ–≥–æ–¥–Ω—è*\n\n"
            "üíµ USD/RUB: 90.75 ‚ÜóÔ∏è\n"
            "üí∂ EUR/RUB: 98.90 ‚ÜóÔ∏è\n"
            "üí¥ CNY/RUB: 12.50 ‚Üí\n"
            "üè¶ –ë–∞–Ω–∫ –†–æ—Å—Å–∏–∏",
        
        "üé≤ –°–ª—É—á–∞–π–Ω–æ–µ —á–∏—Å–ª–æ": 
            f"üé≤ *–°–ª—É—á–∞–π–Ω–æ–µ —á–∏—Å–ª–æ*\n\n–í–∞—à–µ —á–∏—Å–ª–æ: *{random.randint(1, 100)}*",
        
        "üìÖ –î–∞—Ç–∞ –∏ –≤—Ä–µ–º—è": 
            f"üìÖ *–¢–µ–∫—É—â–∞—è –¥–∞—Ç–∞ –∏ –≤—Ä–µ–º—è*\n\n{datetime.now().strftime('%d.%m.%Y %H:%M:%S')}",
        
        "üë§ –û —Å–æ–∑–¥–∞—Ç–µ–ª–µ":
            "üë®‚Äçüíª *–û —Å–æ–∑–¥–∞—Ç–µ–ª–µ*\n\n"
            "–≠—Ç–æ—Ç –±–æ—Ç —Ä–∞–∑—Ä–∞–±–æ—Ç–∞–Ω –≤ —É—á–µ–±–Ω—ã—Ö —Ü–µ–ª—è—Ö\n"
            "–¥–ª—è –ª–∞–±–æ—Ä–∞—Ç–æ—Ä–Ω–æ–π —Ä–∞–±–æ—Ç—ã –ø–æ –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏—é\n\n"
            "üìö –°—Ç—É–¥–µ–Ω—Ç: [–ü—Ä–æ–Ω–∏–Ω –í—è—á–µ—Å–ª–∞–≤ –ö–æ–Ω—Å—Ç–∞–Ω—Ç–∏–Ω–æ–≤–∏—á]\n"
            "üéì –ì—Ä—É–ø–ø–∞: [–ò–£5–¶-73–ë]\n"
            "üè´ –£—á–µ–±–Ω–æ–µ –∑–∞–≤–µ–¥–µ–Ω–∏–µ: [–ú–ì–¢–£ –∏–º. –ù.–≠. –ë–∞—É–º–∞–Ω–∞]",
        
        "üîô –ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é": "–í–æ–∑–≤—Ä–∞—â–∞–µ–º—Å—è –≤ –≥–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é...",
        
        "üéØ –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ": 
            "üéØ *–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏*\n\n"
            "–ó–¥–µ—Å—å –º–æ–≥—É—Ç –±—ã—Ç—å —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã:\n"
            "‚Ä¢ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏\n"
            "‚Ä¢ –°–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã\n"
            "‚Ä¢ –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ —Å API\n"
            "‚Ä¢ –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π",
        
        "üìû –ö–æ–Ω—Ç–∞–∫—Ç—ã":
            "üìû *–ö–æ–Ω—Ç–∞–∫—Ç—ã*\n\n"
            "–î–ª—è —Å–≤—è–∑–∏ —Å —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–æ–º:\n"
            "‚úâÔ∏è Email: example@university.edu\n"
            "üè´ –ö–∞—Ñ–µ–¥—Ä–∞: [–ù–∞–∑–≤–∞–Ω–∏–µ –∫–∞—Ñ–µ–¥—Ä—ã]",
        
        "‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏":
            "‚öôÔ∏è *–ù–∞—Å—Ç—Ä–æ–π–∫–∏*\n\n"
            "–î–æ—Å—Ç—É–ø–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏:\n"
            "üîî –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è: –í–∫–ª\n"
            "üåç –Ø–∑—ã–∫: –†—É—Å—Å–∫–∏–π\n"
            "üì± –¢–µ–º–∞: –°–≤–µ—Ç–ª–∞—è"
    }
    
    if text in responses:
        if text == "üÜò –ü–æ–º–æ—â—å":
            await help_command(update, context)
        elif text == "üîô –ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é":
            await update.message.reply_text(
                responses[text],
                reply_markup=create_main_keyboard()
            )
        elif text in ["üéØ –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ", "üìû –ö–æ–Ω—Ç–∞–∫—Ç—ã", "‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏"]:
            await update.message.reply_text(
                responses[text],
                reply_markup=create_secondary_keyboard()
            )
        else:
            await update.message.reply_text(responses[text], parse_mode='Markdown')
    else:
        await update.message.reply_text(
            "‚ùå –ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –∫–æ–º–∞–Ω–¥–∞. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∫–Ω–æ–ø–∫–∏ –º–µ–Ω—é –∏–ª–∏ /help –¥–ª—è —Å–ø—Ä–∞–≤–∫–∏.",
            reply_markup=create_main_keyboard()
        )

# –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –Ω–µ–∏–∑–≤–µ—Å—Ç–Ω—ã—Ö –∫–æ–º–∞–Ω–¥
async def unknown(update: Update, context: ContextTypes.DEFAULT_TYPE):
    await update.message.reply_text(
        "‚ùå –ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –∫–æ–º–∞–Ω–¥–∞. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ /start –¥–ª—è –Ω–∞—á–∞–ª–∞ —Ä–∞–±–æ—Ç—ã.",
        reply_markup=create_main_keyboard()
    )

# –û—Å–Ω–æ–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è
def main():
    # –°–æ–∑–¥–∞–Ω–∏–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
    application = Application.builder().token(BOT_TOKEN).build()
    
    # –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤
    application.add_handler(CommandHandler("start", start))
    application.add_handler(CommandHandler("help", help_command))
    application.add_handler(MessageHandler(filters.TEXT & ~filters.COMMAND, handle_message))
    application.add_handler(MessageHandler(filters.COMMAND, unknown))
    
    # –ó–∞–ø—É—Å–∫ –±–æ—Ç–∞
    logger.info("–ë–æ—Ç –∑–∞–ø—É—â–µ–Ω...")
    print("–ë–æ—Ç —É—Å–ø–µ—à–Ω–æ –∑–∞–ø—É—â–µ–Ω!")
    print("–û—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –±–æ—Ç–∞ —Å–æ—á–µ—Ç–∞–Ω–∏–µ–º –∫–ª–∞–≤–∏—à Ctrl+C")
    
    application.run_polling()

if __name__ == "__main__":  # –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ: –±—ã–ª–æ name == "main", –Ω—É–∂–Ω–æ __name__ == "__main__"
    main()
